[
  {
    "conditions": {
      "all": [
        {
          "fact": "headers",
          "path": "$.fspiop-source",
          "operator": "notIn",
          "value": [
            "DFSPXOF",
            "DFSPEUR",
            "DFSPMAD"
          ]
        },
        {
          "fact": "payload",
          "path": "$.amount.currency",
          "operator": "notIn",
          "value": {
            "fact": "payee",
            "path": "$.accounts[?(@.ledgerAccountType == 'POSITION' && @.isActive  == 1)].currency"
          }
        },
        {
          "fact": "payload",
          "path": "$.amount.currency",
          "operator": "equal",
          "value": "EUR"
        }
      ]
    },
    "event": {
      "type": "INTERCEPT_QUOTE",
      "params": {
        "rerouteToFsp": "DFSPEUR",
        "sourceCurrency": "EUR",
        "rerouteToFspCurrency": "XOF"
      }
    }
  },
  {
    "conditions": {
      "all": [
        {
          "fact": "headers",
          "path": "$.fspiop-source",
          "operator": "notIn",
          "value": [
            "DFSPXOF",
            "DFSPEUR",
            "DFSPMAD"
          ]
        },
        {
          "fact": "payload",
          "path": "$.amount.currency",
          "operator": "notIn",
          "value": {
            "fact": "payer",
            "path": "$.accounts[?(@.ledgerAccountType == 'POSITION' && @.isActive  == 1)].currency"
          }
        },
        {
          "fact": "payload",
          "path": "$.amount.currency",
          "operator": "equal",
          "value": "XOF"
        }
      ]
    },
    "event": {
      "type": "INTERCEPT_QUOTE",
      "params": {
        "rerouteToFsp": "DFSPEUR",
        "sourceCurrency": "EUR",
        "rerouteToFspCurrency": "XOF"
      }
    }
  },
  {
    "conditions": {
      "all": [
        {
          "fact": "headers",
          "path": "$.fspiop-source",
          "operator": "notIn",
          "value": [
            "DFSPXOF",
            "DFSPEUR",
            "DFSPMAD"
          ]
        },
        {
          "fact": "payload",
          "path": "$.amount.currency",
          "operator": "notIn",
          "value": {
            "fact": "payee",
            "path": "$.accounts[?(@.ledgerAccountType == 'POSITION' && @.isActive  == 1)].currency"
          }
        },
        {
          "fact": "payload",
          "path": "$.amount.currency",
          "operator": "equal",
          "value": "XOF"
        }
      ]
    },
    "event": {
      "type": "INTERCEPT_QUOTE",
      "params": {
        "rerouteToFsp": "DFSPXOF",
        "sourceCurrency": "XOF",
        "rerouteToFspCurrency": "EUR"
      }
    }
  },
  {
    "conditions": {
      "all": [
        {
          "fact": "headers",
          "path": "$.fspiop-source",
          "operator": "notIn",
          "value": [
            "DFSPXOF",
            "DFSPEUR",
            "DFSPMAD"
          ]
        },
        {
          "fact": "payload",
          "path": "$.amount.currency",
          "operator": "notIn",
          "value": {
            "fact": "payer",
            "path": "$.accounts[?(@.ledgerAccountType == 'POSITION' && @.isActive  == 1)].currency"
          }
        },
        {
          "fact": "payload",
          "path": "$.amount.currency",
          "operator": "equal",
          "value": "EUR"
        }
      ]
    },
    "event": {
      "type": "INTERCEPT_QUOTE",
      "params": {
        "rerouteToFsp": "DFSPXOF",
        "sourceCurrency": "XOF",
        "rerouteToFspCurrency": "EUR"
      }
    }
  },
  {
    "conditions": {
      "all": [
        {
          "fact": "payload",
          "path": "$.amountType",
          "operator": "equal",
          "value": "SEND"
        },
        {
          "fact": "payload",
          "path": "$.amount.currency",
          "operator": "notIn",
          "value": {
            "fact": "payer",
            "path": "$.accounts[?(@.ledgerAccountType == 'POSITION' && @.isActive  == 1)].currency"
          }
        }
      ]
    },
    "event": {
      "type": "INVALID_QUOTE_REQUEST",
      "params": {
        "FSPIOPError": "PAYER_UNSUPPORTED_CURRENCY",
        "message": "Requested currency not available for payer. Transfer not allowed."
      }
    }
  },
  {
    "conditions": {
      "all": [
        {
          "fact": "payload",
          "path": "$.amountType",
          "operator": "equal",
          "value": "RECEIVE"
        },
        {
          "fact": "payload",
          "path": "$.amount.currency",
          "operator": "notIn",
          "value": {
            "fact": "payee",
            "path": "$.accounts[?(@.ledgerAccountType == 'POSITION' && @.isActive  == 1)].currency"
          }
        }
      ]
    },
    "event": {
      "type": "INVALID_QUOTE_REQUEST",
      "params": {
        "FSPIOPError": "PAYEE_UNSUPPORTED_CURRENCY",
        "message": "Requested currency not available for payee. Transfer not allowed."
      }
    }
  },
  {
    "conditions": {
      "all": [
        {
          "fact": "headers",
          "path": "$.fspiop-source",
          "operator": "notIn",
          "value": [
            "DFSPXOF",
            "DFSPEUR",
            "DFSPMAD"
          ]
        },
        {
          "fact": "headers",
          "path": "$.fspiop-source",
          "operator": "notEqual",
          "value": {
            "fact": "payload",
            "path": "$.payer.partyIdInfo.fspId"
          }
        }
      ]
    },
    "event": {
      "type": "INVALID_QUOTE_REQUEST",
      "params": {
        "FSPIOPError": "PAYER_REJECTION",
        "message": "The payer FSP does not match the fspiop-source header"
      }
    }
  },
  {
    "conditions": {
      "all": [
        {
          "any": [
            {
              "fact": "payload",
              "path": "$.amount.currency",
              "operator": "notIn",
              "value": {
                "fact": "payee",
                "path": "$.accounts[?(@.ledgerAccountType == 'POSITION' && @.isActive  == 1)].currency"
              }
            },
            {
              "fact": "payload",
              "path": "$.amount.currency",
              "operator": "notIn",
              "value": {
                "fact": "payer",
                "path": "$.accounts[?(@.ledgerAccountType == 'POSITION' && @.isActive  == 1)].currency"
              }
            }
          ]
        },
        {
          "fact": "payload",
          "path": "$.payer.personalInfo.complexName.firstName",
          "operator": "isString",
          "value": false
        }
      ]
    },
    "event": {
      "type": "INVALID_QUOTE_REQUEST",
      "params": {
        "FSPIOPError": "MISSING_ELEMENT",
        "message": "child \"Party\" fails because [child \"PartyPersonalInfo\" fails because [child \"PartyComplexName\" fails because [child \"firstName\" fails because [\"firstName\" is required]]]]"
      }
    }
  },
  {
    "conditions": {
      "all": [
        {
          "any": [
            {
              "fact": "payload",
              "path": "$.amount.currency",
              "operator": "notIn",
              "value": {
                "fact": "payer",
                "path": "$.accounts[?(@.ledgerAccountType == 'POSITION' && @.isActive  == 1)].currency"
              }
            },
            {
              "fact": "payload",
              "path": "$.amount.currency",
              "operator": "notIn",
              "value": {
                "fact": "payee",
                "path": "$.accounts[?(@.ledgerAccountType == 'POSITION' && @.isActive  == 1)].currency"
              }
            }
          ]
        },
        {
          "fact": "payer",
          "path": "$.accounts[?(@.ledgerAccountType == 'POSITION' && @.isActive  == 1)]",
          "operator": "isArray",
          "value": true
        }
      ]
    },
    "event": {
      "type": "INVALID_QUOTE_REQUEST",
      "params": {
        "FSPIOPError": "PAYER_ERROR",
        "message": "Payer FSP has more than 1 active currency account. Switch does not support more than 1 active currency account for Forex Requests"
      }
    }
  },
  {
    "conditions": {
      "all": [
        {
          "any": [
            {
              "fact": "payload",
              "path": "$.amount.currency",
              "operator": "notIn",
              "value": {
                "fact": "payee",
                "path": "$.accounts[?(@.ledgerAccountType == 'POSITION' && @.isActive  == 1)].currency"
              }
            },
            {
              "fact": "payload",
              "path": "$.amount.currency",
              "operator": "notIn",
              "value": {
                "fact": "payer",
                "path": "$.accounts[?(@.ledgerAccountType == 'POSITION' && @.isActive  == 1)].currency"
              }
            }
          ]
        },
        {
          "fact": "payee",
          "path": "$.accounts[?(@.ledgerAccountType == 'POSITION' && @.isActive  == 1)]",
          "operator": "isArray",
          "value": true
        }
      ]
    },
    "event": {
      "type": "INVALID_QUOTE_REQUEST",
      "params": {
        "FSPIOPError": "PAYEE_ERROR",
        "message": "Payee FSP has more than 1 active currency account. Switch does not support more than 1 active currency account for Forex Requests"
      }
    }
  }
]